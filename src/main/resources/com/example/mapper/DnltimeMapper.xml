<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.DnltimeMapper">

<resultMap type="com.example.domain.Dnltime" id="dnltimeWithDnl">
	<id property="dnlno" column="dt_dnlno"/>
	<result	property="attend" column="dt_attend"/>
	<result property="leave" column="dt_leave"/>
	<result property="reason" column="dt_reason"/>
	<result property="dnlCode" column="dt_dnl_code"/>
	<result property="membersrl" column="dt_membersrl"/>
	<association property="dnl" javaType="com.example.domain.Dnl">
		<id property="dnlCode" column="d_dnl_code"/>
		<result property="dnlType" column="d_dnl_type"/>
	</association>
</resultMap>

<select id="selectAllWithDnl" resultMap="dnltimeWithDnl">
	select 
		d.dnl_code		as d_dnl_code,
		d.dnl_type		as d_dnl_type,
		dt.dnlno		as dt_dnlno,
		dt.attend		as dt_attend,
		dt.leave		as dt_leave,
		dt.reason		as dt_reason,
		dt.dnl_code		as dt_dnl_code,
		dt.membersrl	as dt_membersrl
 from dnl d right outer join dnltime dt 
  on d.dnl_code = dt.dnl_code
  order by dt.dnlno
</select>

<select id="selectPageWithDnl" resultMap="dnltimeWithDnl">
	select 
		d.dnl_code		as d_dnl_code,
		d.dnl_type		as d_dnl_type,
		dt.dnlno		as dt_dnlno,
		dt.attend		as dt_attend,
		dt.leave		as dt_leave,
		dt.reason		as dt_reason,
		dt.dnl_code		as dt_dnl_code,
		dt.membersrl	as dt_membersrl
 from dnl d right outer join dnltime dt 
  on d.dnl_code = dt.dnl_code
   order by dt.dnlno
 offset #{firstItem} -1 rows
  fetch next #{itemsPerPage} rows only
</select>

<select id="selectByDnlnoWithDnl" resultMap="dnltimeWithDnl">
	select 
		d.dnl_code		as d_dnl_code,
		d.dnl_type		as d_dnl_type,
		dt.dnlno		as dt_dnlno,
		dt.attend		as dt_attend,
		dt.leave		as dt_leave,
		dt.reason		as dt_reason,
		dt.dnl_code		as dt_dnl_code,
		dt.membersrl	as dt_membersrl
 from dnl d right outer join dnltime dt 
  on d.dnl_code = dt.dnl_code
 where dnlno = #{dnlno}
</select>

<insert id="insert">
	<selectKey keyProperty="dnlno" keyColumn="dnlno" resultType="int" order="BEFORE">
		select dnl_dnlno_seq.nextval from dual
	</selectKey>
		insert into dnltime
	(
		dnlno,
		attend,
		leave,
		reason,
		dnl_code,
		membersrl
	)   
	  values
	  (
		#{dnlno},
		#{attend},
		#{leave},
		#{reason},
		#{dnlCode},
		#{membersrl}	  
	  )
</insert>
</mapper>